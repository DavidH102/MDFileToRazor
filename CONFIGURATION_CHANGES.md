# Configuration Simplification: OutputDirectory and DefaultLayout Now Optional

## Overview

As of version 1.0.X, both `OutputDirectory` and `DefaultLayout` properties in `MarkdownToRazorOptions` have been simplified to better reflect the dual-purpose architecture of MarkdownToRazor.

## Understanding the Two Architecture Patterns

### 1. Build-Time Generation (Primary Use Case)

- **What it does**: Converts markdown files to actual `.razor` files during build
- **When routes work**: Generated `.razor` files have `@page` directives that Blazor automatically discovers
- **Service registration purpose**: Enables dynamic navigation UI by discovering markdown files and their routes
- **OutputDirectory**: Not needed in service registration (files are generated by build tools, not runtime services)

### 2. Runtime Rendering (Advanced Use Case)

- **What it does**: Renders markdown content dynamically using `MarkdownSection` component
- **When routes work**: Routes are NOT automatically registered - requires custom route handling
- **Service registration purpose**: Provides markdown file discovery and content loading services
- **OutputDirectory**: Not needed (no files are generated)

## Why These Changes?

### OutputDirectory Made Optional

Previously, the configuration required both `SourceDirectory` and `OutputDirectory` even when no files are being generated by the runtime services. This created confusion because:

- **Build-time scenarios**: Files are generated by build tools (CodeGeneration project, MSBuild targets), not by runtime services
- **Runtime scenarios**: Use `MarkdownSection` component to render markdown dynamically - no files are generated

The key insight: **Service registration is for runtime services, not build-time generation**

### DefaultLayout Removed

The `DefaultLayout` property was completely unused and redundant because:

- Blazor components automatically use the app's default layout when no layout is specified
- The `MarkdownSection` component doesn't specify any layout, so it inherits the app's default
- Having a separate `DefaultLayout` configuration added unnecessary complexity

## What Changed

### Before (Confusing Configuration)

```csharp
// This was confusing - OutputDirectory implied runtime generation
builder.Services.AddMarkdownToRazorServices(options =>
{
    options.SourceDirectory = "content";
    options.OutputDirectory = "Pages/Generated"; // Misleading - services don't generate files
    options.DefaultLayout = "MainLayout"; // Redundant - app already has default layout
    options.BaseRoutePath = "/docs";
});
```

### After (Clear Purpose-Driven Configuration)

```csharp
// Build-time scenarios: Service registration for dynamic navigation
builder.Services.AddMarkdownToRazorServices(options =>
{
    options.SourceDirectory = "content"; // Where markdown files are located
    options.BaseRoutePath = "/docs"; // Route prefix for generated pages
    // OutputDirectory omitted - files generated by build tools, not services
    // DefaultLayout omitted - component uses app's default layout automatically
});

// Runtime scenarios: Service registration for dynamic rendering
builder.Services.AddMarkdownToRazorServices(options =>
{
    options.SourceDirectory = "content"; // Where markdown files are located
    // No OutputDirectory - files are rendered dynamically
    // No BaseRoutePath - routes handled manually in components
});
```

## Common Use Cases

### ✅ Build-Time Generation + Dynamic Navigation (Recommended)

**Files generated at build-time, service registration for navigation:**

```csharp
// 1. Generate files during build (MSBuild target or manual)
// 2. Register services for dynamic navigation
builder.Services.AddMarkdownToRazorServices(options =>
{
    options.SourceDirectory = "content";
    options.BaseRoutePath = "/docs";
});

// 3. Use in navigation components
@inject IMdFileDiscoveryService MdFileDiscovery

<FluentNavGroup Title="Documentation">
    @foreach (var (filename, route) in await MdFileDiscovery.DiscoverMarkdownFilesWithRoutesAsync())
    {
        <FluentNavLink Href="@route">@GetDisplayName(filename)</FluentNavLink>
    }
</FluentNavGroup>
```

### ✅ Runtime Rendering Only (Advanced)

**Dynamic markdown rendering without generated pages:**
builder.Services.AddMarkdownToRazorServices(options =>
{
options.SourceDirectory = "content";
options.OutputDirectory = "Pages/Generated"; // Required for build-time generation
options.BaseRoutePath = "/docs";
// DefaultLayout still omitted - uses app's default layout
});

````

## Technical Details

### API Changes

- `OutputDirectory` property is now nullable (`string?`)
- `DefaultLayout` property has been completely removed
- `GetAbsoluteOutputPath()` returns `null` when `OutputDirectory` is not set
- `IMdFileDiscoveryService.GetOutputDirectory()` returns `string?` instead of `string`
- Configuration validation no longer requires `OutputDirectory`

### Backward Compatibility

- ✅ Existing code with `OutputDirectory` set continues to work unchanged
- ✅ Build-time scenarios still function exactly as before
- ✅ All existing tests pass without modification

### Usage Patterns

#### Runtime-Only (Recommended)

- Use `MarkdownSection` component to render markdown
- Routes discovered automatically via `IMdFileDiscoveryService`
- No files generated - everything happens at runtime
- **Do not set `OutputDirectory`**

#### Build-Time Generation

- Markdown files converted to `.razor` files during build
- Generated pages compiled into application
- Use MSBuild targets or CodeGeneration project
- **Must set both `SourceDirectory` and `OutputDirectory`**

## Migration Guide

### If you're using runtime rendering only

```csharp
// Remove both OutputDirectory and DefaultLayout from your configuration
builder.Services.AddMarkdownToRazorServices(options =>
{
    options.SourceDirectory = "your-source-path";
    // options.OutputDirectory = "Pages/Generated"; // ← Remove this line
    // options.DefaultLayout = "MainLayout"; // ← Remove this line
    options.BaseRoutePath = "/docs";
});
````

### If you're using build-time generation

```csharp
// Keep OutputDirectory but remove DefaultLayout
builder.Services.AddMarkdownToRazorServices(options =>
{
    options.SourceDirectory = "your-source-path";
    options.OutputDirectory = "Pages/Generated"; // ← Keep this for build-time scenarios
    // options.DefaultLayout = "MainLayout"; // ← Remove this line
    options.BaseRoutePath = "/docs";
});
```

## Files Modified

- `src/MarkdownToRazor.Components/Configuration/MarkdownToRazorOptions.cs` - Removed DefaultLayout property
- `src/MarkdownToRazor.Components/Services/IMdFileDiscoveryService.cs` - Made OutputDirectory nullable
- `src/MarkdownToRazor.Components/Services/MdFileDiscoveryService.cs` - Updated OutputDirectory handling
- `src/MarkdownToRazor.Sample.BlazorServer/Program.cs` - Removed DefaultLayout from configuration
- `docs/USAGE.md` - Updated examples to remove DefaultLayout
- `README.md` - Updated configuration examples
- `.github/copilot-instructions.md` - Updated architectural documentation

## Test Results

All 22 tests pass with the new configuration:

- ✅ Path handling tests
- ✅ Service registration tests
- ✅ Route discovery tests
- ✅ File loading tests
- ✅ Backward compatibility tests
